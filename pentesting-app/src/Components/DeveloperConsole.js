import React, { Component } from 'react'

export default class DeveloperConsole extends Component {
    constructor(props) {
        super(props)

        // set up state variables
        this.state = {
            sourceCode: ''
        }

        // bind functions 
        this.sendInput = this.sendInput.bind(this)
        this.onCodeChanged = this.onCodeChanged.bind(this)
    }

    /**
     * Sends sourceCode to the reverse http shell.
     */
    sendInput() {
        // put the sourceCode to the reverse shell
        fetch(`https://localhost:44349/api/ScriptEngine/${this.props.clientId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                "id": this.props.clientId,
                "input": this.state.sourceCode
            })
        })
    }

    /**
     * Updates the source code state variable on change of the text area.
     */
    onCodeChanged(){
        // get source code from text area
        var text = document.getElementById('SourceCode').value
        // set state of source code
        this.setState({
            sourceCode: text
        })
    }

    render() {
        return (
            <div className='Console'>
                <strong>Developer Console</strong> <br />
                <button onClick={this.sendInput}>Send</button> <br />
                <hr />
                <textarea id='SourceCode' rows='15' cols='83' onChange={this.onCodeChanged}></textarea>
            </div>
        )
    }
}
